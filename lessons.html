<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>selenix — Lessons</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="selenix.css">
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="container nav">
      <a class="brand" href="index.html">
        <img alt="selenix logo">
        <div class="logo-text">selenix</div>
      </a>
      <nav class="nav-links">
        <a href="index.html">Home</a>
        <a href="index.html#about">About</a>
        <a href="lessons.html">Lessons</a>
        <a href="index.html#contact">Contact</a>
        <button class="icon-btn" data-open-search aria-label="Search">
  <img
    class="search-icon"
    src="https://cdn-icons-png.flaticon.com/128/3686/3686896.png"
    alt="Search"
    loading="lazy"
    decoding="async">
</button>
      </nav>
      <button class="icon-btn hamburger" aria-label="Menu">
        <span></span><span></span><span></span>
      </button>
    </div>
    <div class="mobile-drawer">
      <a href="index.html">Home</a>
      <a href="index.html#about">About</a>
      <a href="lessons.html">Lessons</a>
      <a href="index.html#contact">Contact</a>
      <a href="#" data-open-search>Search</a>
    </div>
    <div class="mobile-searchbar">
      <form id="mobileSearchForm">
        <input id="mobileSearch" placeholder="Search lessons...">
        <button type="submit">Search</button>
      </form>
    </div>
  </header>

  <!-- Search overlay -->
  <div class="search-overlay" id="searchOverlay">
    <div class="search-card">
      <h3>Search lessons</h3>
      <div class="search-row">
        <input id="globalSearchInput" placeholder="Type keyword...">
        <button id="globalSearchGo">Search</button>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="back-row">
      <button data-back>← Back</button>
    </div>
    <h2>Lessons</h2>
    <div class="chips" id="subjectChips"></div>
    <div class="lessons-wrap" id="lessonsWrap"></div>
  </div>

  <!-- Subject picker modal (opens on load) -->
  <div class="modal open" id="subjectPicker">
    <div class="modal-card">
      <div class="modal-header">
        <h3>Select a Subject</h3>
        <button class="icon-btn" id="closePicker">✕</button>
      </div>
      <div class="modal-body">
        <div class="chips" id="pickerChips"></div>
        <p style="margin-top:10px;color:#666;font-size:14px">Tip: You can change subjects anytime with the chips above.</p>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-top-art"></div>
    <div class="container">
      <div class="footer-inner" style="grid-column:1/-1;display:flex;flex-direction:column;align-items:center;text-align:center;gap:18px;padding-top:10px;padding-bottom:50px">
        <div class="footer-social" style="display:flex;gap:18px">
          <a href="https://t.me/example" target="_blank" aria-label="Telegram" title="Telegram"
             style="width:44px;height:44px;border-radius:50%;background:#fff;color:#111;display:inline-flex;align-items:center;justify-content:center;font-size:26px;text-decoration:none">
            <i class='bx bxl-telegram'></i>
          </a>
          <a href="https://www.youtube.com/@SeleNix_Offcial" target="_blank" aria-label="YouTube" title="YouTube"
             style="width:44px;height:44px;border-radius:50%;background:#fff;color:#111;display:inline-flex;align-items:center;justify-content:center;font-size:26px;text-decoration:none">
            <i class='bx bxl-youtube'></i>
          </a>
        </div>
        <nav class="footer-menu" style="display:flex;gap:26px;flex-wrap:wrap;justify-content:center">
          <a href="index.html" style="color:#eaeaea;text-decoration:none">Home</a>
          <a href="index.html#about" style="color:#eaeaea;text-decoration:none">About</a>
          <a href="lessons.html" style="color:#eaeaea;text-decoration:none">Lessons</a>
          <a href="index.html#contact" style="color:#eaeaea;text-decoration:none">Contact</a>
        </nav>
        <div class="footer-copy" style="font-size:13px;color:#bdbdbd">© 2025 selenix • DO SUMTHING GOOD</div>
      </div>
    </div>
  </footer>

  <!-- Shared helpers -->
  <script src="selenix.js"></script>

  <!-- Page script -->
  <script>
  const state = { items:[], groups:[], subjects:[], colors:{}, activeSubject:'All' };

  function readQuery(){
    const p = new URLSearchParams(location.search);
    const subject = p.get('subject'); const lesson = p.get('lesson');
    return {subject, lesson};
  }

  function buildSubjectChips(){
    const wrap = document.getElementById('subjectChips');
    wrap.innerHTML = '';
    const allChip = chip('All', 'All' === state.activeSubject);
    wrap.appendChild(allChip);
    state.subjects.forEach(sub=>{
      wrap.appendChild(chip(sub, sub === state.activeSubject, state.colors[sub]));
    });
  }
  function chip(label, active, color){
    const el = document.createElement('button');
    el.className = 'chip' + (active?' active':'');
    if(color) el.style.setProperty('--subject-color', color);
    el.textContent = label;
    el.addEventListener('click', ()=>{
      state.activeSubject = label;
      buildSubjectChips();
      renderLessons();
    });
    return el;
  }

  function renderLessons(){
    const wrap = document.getElementById('lessonsWrap');
    wrap.innerHTML = '';
    let list = state.groups;
    if (state.activeSubject !== 'All') list = list.filter(g=>g.subject === state.activeSubject);

    const q = readQuery();
    if (q.subject && q.lesson){
      list = list.filter(g=>g.subject===q.subject && g.lesson===q.lesson);
    }

    list.forEach(group=>{
      const groupDiv = document.createElement('div');
      groupDiv.className = 'lesson-group';
      groupDiv.style.setProperty('--subject-color', state.colors[group.subject] || '#000');

      const head = document.createElement('div');
      head.className = 'lesson-header';
      head.appendChild(selenix.makeSubjectDot(state.colors[group.subject]));
      const title = document.createElement('div');
      title.className = 'lesson-title';
      title.textContent = `${group.lesson}`;
      head.appendChild(title);
      const subtitle = document.createElement('div');
      subtitle.className = 'lesson-subtitle';
      subtitle.textContent = `${group.subject} • ${selenix.formatCount(group.parts.length)}`;
      head.appendChild(subtitle);
      groupDiv.appendChild(head);

      const partsWrap = document.createElement('div');
      partsWrap.className = 'parts';
      group.parts.forEach(p=>{
        const row = document.createElement('div');
        row.className = 'part-row';
        const dot = document.createElement('span');
        dot.className = 'dot';
        dot.style.setProperty('--subject-color', state.colors[group.subject]);
        row.appendChild(dot);

        const meta = document.createElement('div');
        meta.className = 'part-meta';
        const t = document.createElement('div'); t.className='part-title'; t.textContent = p.partTitle || '(Untitled part)';
        const d = document.createElement('div'); d.className='part-desc'; d.textContent = p.description || '';
        meta.appendChild(t); meta.appendChild(d);
        row.appendChild(meta);

        const actions = document.createElement('div'); actions.className='part-actions';
        const watch = document.createElement('button'); watch.className='btn'; watch.textContent='Open Player';
        watch.addEventListener('click', ()=> {
          window.location.href = `player.html?rid=${encodeURIComponent(p.id)}`;
        });
        actions.appendChild(watch);
        row.appendChild(actions);

        partsWrap.appendChild(row);
      });
      groupDiv.appendChild(partsWrap);
      wrap.appendChild(groupDiv);
    });
  }

  async function boot(){
    selenix.initHeader();
    try {
      state.items = await selenix.fetchSheet();
      state.groups = selenix.groupByLesson(state.items);
      state.subjects = selenix.uniqueSubjects(state.items);
      state.colors = selenix.subjectColorMap(state.subjects);

      const pick = document.getElementById('pickerChips');
      pick.innerHTML = '';
      pick.appendChild(chip('All', true));
      state.subjects.forEach(s=>{
        const c = chip(s, false, state.colors[s]);
        pick.appendChild(c);
      });

      document.getElementById('closePicker').addEventListener('click', ()=>{
        document.getElementById('subjectPicker').classList.remove('open');
      });

      const q = readQuery();
      if (q.subject){ state.activeSubject = q.subject; document.getElementById('subjectPicker').classList.remove('open'); }

      buildSubjectChips();
      renderLessons();
    } catch (e){
      console.error(e);
      document.getElementById('lessonsWrap').innerHTML = '<p>Failed to load lessons. Please check your sheet sharing settings.</p>';
    }
  }
  boot();
  </script>
</body>

</html>
